# VOICE_CONVERSATION – زنجیرهٔ مکالمه صوتی (ساده و همگام)

## هدف
پیاده‌سازی مکالمهٔ صوتی بدون Real-Time:
1) STT: ورودی صوت → متن
2) LLM: پردازش متن → پاسخ متنی
3) TTS: پاسخ متنی → خروجی صوت

## قیود (الزام)
- بدون جریان/استریم/وب‌سوکت
- فقط OpenAI:
  - STT: Whisper
  - LLM: مدل‌های text_gen/text2text از `.env`
  - TTS: مدل‌های OpenAI TTS (مثلا `tts-1`, `tts-1-hd`)
- تنظیم مدل‌ها از `.env` + امکان override در درخواست (اگر معتبر باشد)

## قرارداد ورودی/خروجی سرویس مکالمه
- ورودی: فایل صوتی (multipart/form-data) یا باینری
  - هدر/فیلدهای اختیاری: `stt_model`, `text_model`, `tts_model`
  - هدرهای کلاینت OpenAI (اختیاری): 
    - `X-OpenAI-Base-URL` → اگر نبود، از `OPENAI_BASE_URL`
    - `X-OpenAI-Key` → اگر نبود، از `OPENAI_API_KEY`
- خروجی:
  - `transcript`: متن تبدیل‌شده از STT
  - `text_response`: پاسخ متنی LLM
  - `audio`: صوت تولیدشده (فرمت متداول)، یا Base64
  - متادیتا: نام مدل‌های استفاده‌شده

## کلاینت OpenAI (الزام)
- باید **هر دو** را بپذیرد:
  - API Base URL (از هدر یا env)
  - API Key (از هدر یا env)
- اگر هدر نبود → از `.env` استفاده شود.
- اگر هیچ کلیدی موجود نبود → خطای پیکربندی شفاف.

## مدیریت خطا (حداقلی و شفاف)
- ورودی نامعتبر صوت → خطای 400 با پیام کوتاه
- عدم پیکربندی مدل‌ها → خطای 500 با پیام پیکربندی
- خطای OpenAI → خطای 502/503 با پیام خلاصه

## عملکرد
- پردازش کاملاً همگام و ترتیبی (۱→۲→۳)
- اندازه فایل و تایم‌اوت منطقی، قابل تنظیم در لایهٔ تنظیمات
- بدون کش و بدون ذخیره‌سازی الزامی (Stateless)
